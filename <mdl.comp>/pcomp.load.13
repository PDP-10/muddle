<SNAME "MDL.COMP">

<LINK '<ERRET T> "" <ROOT>>

<PACKAGE "COMPDEC">
<OR <ASSIGNED? PURE!-> <SET PURE!- T>>
<ENTRY BEGIN-HACK BEGIN-MHACK>
<LINK OP!-PACKAGE!- "OP" <2 .OBLIST>>

<FLOAD "PS:<COMPIL>NEWOP.MUD">
<FLOAD "PS:<COMPIL>BOPHAC.MUD">
<FLOAD "PS:<COMPIL>MUDHAK.MUD">

<BEGIN-HACK "BTB">

<BEGIN-MHACK>

<REMOVE "OP" <1 .OBLIST>>

<ENDPACKAGE>

<BLOCK (<ROOT>)>

<SETG EXPERIMENTAL T>
<SET TEMPLATE-DATA T>

GLUE PGLUE

<COND (<NOT <ASSIGNED? SILENT!->><SET SILENT!- <>>)>

<COND (<NOT .SILENT> <PRINC " LOADING MUDDLE COMPILER "> <TERPRI>)>
<ENDBLOCK>

<BLOAT 100000 5000 100 1500 100>

<PROG ((GLUE <COND (<ASSIGNED? GLUE> .GLUE)>)) #DECL ((GLUE) <SPECIAL ANY>)
<FLOAD "PS:<COMPIL>ASSEM.FBIN">>

<PACKAGE "CODING" "IC">

<FLOAD "PS:<COMPIL>ATOSQ.NBIN">
<SETG ONLY-FAST-OUTPUT T>

<ENDPACKAGE>

<SETG L-NOISY <>>
<SETG L-NO-DEFER T>

<FLOAD "PS:<COMPIL>CONNECT-DIR.NBIN">

<CONNECT-DIR "PS:<COMPIL>">

<USE "MACROS" "SORTX" "DOW" "DATIME" "TIMFCN" "NOW" "DFL" "FINDATOM">

<CONNECT-DIR "SRC:<MDL.COMP>">

<PACKAGE "COMPDEC">

<LINK ASSEMBLE1!-CODING!-PACKAGE "ASSEMBLE1" <1 .OBLIST>>

<FLOAD "PS:<COMPIL>WOFCH.FBIN">
<FLOAD "PS:<COMPIL>POPWR2.FBIN">

<SETG DEATH T>

<ENDPACKAGE>

<FLOAD "COMPDE.FBIN">
<FLOAD "BIGANA.FBIN">

<USE "PASS1" "CODGEN" "SYMANA" "CHKDCL" "MAPPS1" "CUP" "MAPANA" "MAPGEN"
     "VARANA" "CARANA" "NEWREP" "BACKAN" "CBACK" "COMSUB" "CARGEN" "CONFOR"
     "CDRIVE" "CPRINT" "COMTEM" "NOTANA" "NOTGEN" "STRANA" "STRGEN" "ALLR"
     "LNQGEN" "MMQGEN" "ISTRUC" "INFCMP" "BITTST" "BITANA" "BITSGEN" "BUILDL"
     "SPCGEN" "ADVMES" "CACS" "COMCOD" "NPRINT" "CASE" "PEEPH">


<MAPF <> <FUNCTION (ATM "AUX" (O <OBLIST? .ATM>)) <INSERT <REMOVE .ATM> .O>>
	'(LOGOUT ERROR ERRET QUIT COND AGAIN REP TAG REDEFINE VALRET T)>

<PACKAGE "DUMP-C">

<USE "COMPDEC">

<DEFINE DUMP-COMP!- (N
                   "OPTIONAL" (GCQ T) (SN <SNAME>)  UNM
		    "AUX" CH (SR .READ-TABLE))
	<UNASSIGN <GUNASSIGN READ-TABLE>>
	<SETG OQ ,QUIT>
        <SNAME "">
        <COND (<=? <FSAVE .N .GCQ> "SAVED">
               <SNAME .SN>
	       <SET READ-TABLE <SETG READ-TABLE .SR>>)
              (<AND <OR <=? <SET UNM <UNAME>> "CLR">
			<=? .UNM "BTB">
			<=? .UNM "BKD">
			<=? .UNM "LIM">
			<=? .UNM "TAA">>
		    <OR <=? <SET SN <SNAME>> "COMPIL">
			<=? .SN "MDL.COMP">>>
	       <BEGIN-HACK "COMPIL"><BEGIN-MHACK> <RSUBR-LINK <>>
	       <PRINC "` and | hacks enabled. Rsubr-Link <>"> <CRLF>)
	      (ELSE
	       <SET SN <SNAME>>
	       <COND (<SET CH <OPEN "READ" <COND (<=? .UNM "COMBAT">
						  "PCOMP.PLAN.-2")
						 ("PCOMP.PLAN")>>>
		       <LOAD .CH>
		       <QUIT>)
		     (ELSE
		      <CRLF>)>)>
        <PRINC "MUDDLE COMPILER NOW READY.">
        <CRLF>
        T>

<ENDPACKAGE>

<INSERT <REMOVE COMPILE> <ROOT>>

<INSERT <REMOVE COMPILE-GROUP> <ROOT>>

<PACKAGE "COMPDEC">

<ENTRY DC UDC>
<LINK '<DC> "" <ROOT>>

<DEFINE DC ()
<USE-TOTAL "PASS1" "CODGEN" "SYMANA" "CHKDCL" "MAPPS1" "CUP" "MAPANA" "MAPGEN"
    	 "VARANA" "CARANA" "NEWREP" "BACKAN" "CBACK" "COMSUB" "CARGEN" "CONFOR"
    	 "CDRIVE" "CPRINT" "COMTEM" "NOTANA" "NOTGEN" "STRANA" "STRGEN" "ALLR"
    	"LNQGEN" "MMQGEN" "ISTRUC" "INFCMP" "BITTST" "BITANA" "BITSGEN" "BUILDL"
    	 "SPCGEN" "ADVMES" "CACS" "COMCOD" "NPRINT" "CASE" "PEEPH" "COMPDEC">>

<DC>

<DEFINE C ("OPTIONAL" (N 0)) <PRT <REST .CODE:TOP .N>>>

<PRIN-SET>


<FLOAD "PS:<COMPIL>PRIMHK.NBIN">

<FLOAD "PS:<COMPIL>PRNTYP">

<SETG EXPERIMENTAL T>

<DEFINE UDC ()
<DROP "PASS1" "CODGEN" "SYMANA" "CHKDCL" "MAPPS1" "CUP" "MAPANA" "MAPGEN"
    	 "VARANA" "CARANA" "NEWREP" "BACKAN" "CBACK" "COMSUB" "CARGEN" "CONFOR"
    	 "CDRIVE" "CPRINT" "COMTEM" "NOTANA" "NOTGEN" "STRANA" "STRGEN" "ALLR"
    	"LNQGEN" "MMQGEN" "ISTRUC" "INFCMP" "BITTST" "BITANA" "BITSGEN" "BUILDL"
    	 "SPCGEN" "ADVMES" "CACS" "COMCOD" "NPRINT" "CASE" "PEEPH" "COMPDEC">>

<ENDPACKAGE>

<FLOAD "NCOMFI.MUD">

<PROG () <PRINC "Peep Hole optimizer enabled?">
	<SET PEEP!-PEEPH!-PACKAGE <ERROR>>
	<CRLF>
	<PRINC "KILL-COMP disabled">
	<CRLF>
	<SETG KILL-COMP!-IFCOMPIL!-FCOMPIL!-PACKAGE ,TIME>>

<DROP "MACROS" "SORTX" "DOW" "DATIME" "TIMFCN">

<DROP "PASS1" "CODGEN" "SYMANA" "CHKDCL" "MAPPS1" "CUP" "MAPANA" "MAPGEN"
     "VARANA" "CARANA" "NEWREP" "BACKAN" "CBACK" "COMSUB" "CARGEN" "CONFOR"
     "CDRIVE" "CPRINT" "COMTEM" "NOTANA" "NOTGEN" "STRANA" "STRGEN" "ALLR"
     "LNQGEN" "MMQGEN" "ISTRUC" "INFCMP" "BITTST" "BITANA" "BITSGEN" "BUILDL"
     "SPCGEN" "ADVMES" "CACS" "COMCOD" "NPRINT" "CASE" "PEEPH">

<RSUBR-LINK <>>
<USE "FCOMPIL">
<SET DISOWN <>>
